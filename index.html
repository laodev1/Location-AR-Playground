<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'
    </script>
</head>

<body style='margin: 0; overflow: hidden;'>
    <a-scene vr-mode-ui="enabled: false" embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>


        <a-entity gltf-model="./assets/models/enchanted-mirror/scene.gltf" rotation="" scale="-2.1 -2.1 -2.1"
            gps-entity-place="longitude: 33.42651999999945; latitude: -111.94046000000473;" />
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <!-- methods to move the model location around, change the scale etc. using the mouse-->
    <script>
        var entity = document.querySelector('a-entity');
        console.log(entity);
        var scale = 0.1;
        var longitude = 33.42651999999945;
        var latitude = -111.94046000000473;
        var longitudeStep = 0.0001;
        var latitudeStep = 0.0001;
        var scaleStep = 0.01;

        document.addEventListener('keydown', function (event) {
           let entity = document.querySelector('a-entity');
           console.log('latitude', latitude, 'longitude', longitude, 'scale', scale)
            if (event.key === 'ArrowUp') {
                latitude += latitudeStep;
                entity.setAttribute('gps-entity-place', 'longitude: ' + longitude + '; latitude: ' + latitude + ';');
            } else if (event.key === 'ArrowDown') {
                latitude -= latitudeStep;
                entity.setAttribute('gps-entity-place', 'longitude: ' + longitude + '; latitude: ' + latitude + ';');
            } else if (event.key === 'ArrowLeft') {
                longitude -= longitudeStep;
                entity.setAttribute('gps-entity-place', 'longitude: ' + longitude + '; latitude: ' + latitude + ';');
            } else if (event.key === 'ArrowRight') {
                longitude += longitudeStep;
                entity.setAttribute('gps-entity-place', 'longitude: ' + longitude + '; latitude: ' + latitude + ';');
            } else if (event.key === 'w') {
                scale += scaleStep;
                entity.setAttribute('scale', scale + ' ' + scale + ' ' + scale);
            } else if (event.key === 's') {
                scale -= scaleStep;
                entity.setAttribute('scale', scale + ' ' + scale + ' ' + scale);
            }
        });
        let initialDistance = null;

            function getDistance(touches) {
                let dx = touches[0].pageX - touches[1].pageX;
                let dy = touches[0].pageY - touches[1].pageY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            document.addEventListener('touchstart', function (event) {
                if (event.touches.length === 2) {
                    initialDistance = getDistance(event.touches);
                }
            });

            document.addEventListener('touchmove', function (event) {
                if (event.touches.length === 2) {
                    let distance = getDistance(event.touches);
                    let scaleChange = distance - initialDistance;
                    scale += scaleChange * 0.001; // Scale factor adjustment
                    entity.setAttribute('scale', `${scale} ${scale} ${scale}`);
                    initialDistance = distance;
                }
            });

            document.addEventListener('touchend', function (event) {
                initialDistance = null; // Reset initial distance on touch end
            });
    </script>

</body>

</html>