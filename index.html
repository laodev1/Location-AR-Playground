<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'
    </script>
</head>

<body style='margin: 0; overflow: hidden;'>
    <a-scene vr-mode-ui="enabled: false" embedded id="arScene">
        <!-- Adjusted scale to 0.005 (original scale of 5 divided by 1,000) -->
        <a-entity gltf-model="./assets/models/enchanted-mirror/scene.gltf" scale="0.005 0.005 0.005"
            id="mirrorEntity"></a-entity>
        <a-camera gps-new-camera  look-controls-enabled='false' arjs-device-orientation-controls='smoothingFactor: 0.1' ></a-camera>
    </a-scene>


    <script>
        function updateARSceneSize() {
            var scene = document.getElementById('arScene');
            var width = window.innerWidth;
            var height = window.innerHeight;

            // Update the arjs attributes
            scene.setAttribute('arjs', 'sourceType: webcam; sourceWidth:' + width + '; sourceHeight:' + height + '; displayWidth:' + width + '; displayHeight:' + height + '; debugUIEnabled: false;');
        }

        // Update AR.js scene size on load and window resize
        window.addEventListener('load', updateARSceneSize);
        window.addEventListener('resize', updateARSceneSize);

        // Function to convert degrees to radians
        function toRadians(degrees) {
            return degrees * Math.PI / 180;
        }

        // Function to calculate new latitude 20 feet to the north
        function calculateNewLatitude(lat, distance) {
            // Earth's radius in feet
            var earthRadius = 20902231;

            // Convert distance to radians
            var distanceRadians = distance / earthRadius;

            // Convert latitude to radians
            var latRadians = toRadians(lat);

            // Calculate new latitude
            var newLatRadians = latRadians + distanceRadians;

            // Convert back to degrees
            return newLatRadians * 180 / Math.PI;
        }

        // Get user's current location
        navigator.geolocation.getCurrentPosition(function (position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            // Calculate new latitude 20 feet to the north
            var newLatitude = calculateNewLatitude(latitude, 20);

            // Set mirror's position to new location
            var mirrorEntity = document.getElementById('mirrorEntity');
            mirrorEntity.setAttribute('gps-entity-place', `latitude: ${newLatitude}; longitude: ${longitude};`);
        });
    </script>

</body>

</html>